<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
    <Product Id="1da9cbfe-c311-43ae-8310-d201ec1da835" Name="CMake Tools for Visual Studio" Language="1033" Version="1.0.0.0" Manufacturer="David Golub" UpgradeCode="38709d2b-9fe1-448d-8e5d-c55c1555c620">
        <Package InstallerVersion="200" Compressed="yes" />

        <Media Id="1" Cabinet="CMakeTools.cab" EmbedCab="yes" />

        <Icon Id="CMakeLogo" SourceFile="dist\CMakeLogo.ico" />
        
        <Property Id="ARPPRODUCTICON" Value="CMakeLogo" />
        <Property Id="VS2010DIR">
            <RegistrySearch Id="VS2010InstallDir" Type="raw" Root="HKLM" Key="SOFTWARE\Microsoft\VisualStudio\10.0" Name="InstallDir" />
        </Property>
        <Property Id="VS2010DEVENV">
            <RegistrySearch Id="VS2010EnvironmentPath" Type="raw" Root="HKLM" Key="SOFTWARE\Microsoft\VisualStudio\10.0\Setup\VS" Name="EnvironmentPath" />
        </Property>
        <Property Id="VS2010SHELL">
            <RegistrySearch Id="VS2010ShellFolder" Type="raw" Root="HKLM" Key="SOFTWARE\Microsoft\VisualStudio\10.0" Name="ShellFolder" />
        </Property>
        <Property Id="VS2012DIR">
            <RegistrySearch Id="VS2012InstallDir" Type="raw" Root="HKLM" Key="SOFTWARE\Microsoft\VisualStudio\11.0" Name="InstallDir" />
        </Property>
        <Property Id="VS2012DEVENV">
            <RegistrySearch Id="VS2012EnvironmentPath" Type="raw" Root="HKLM" Key="SOFTWARE\Microsoft\VisualStudio\11.0\Setup\VS" Name="EnvironmentPath" />
        </Property>
        <Property Id="VS2012SHELL">
            <RegistrySearch Id="VS2012ShellFolder" Type="raw" Root="HKLM" Key="SOFTWARE\Microsoft\VisualStudio\11.0" Name="ShellFolder" />
        </Property>

        <CustomAction Id="VS2012Setup" Property="VS2012DEVENV" ExeCommand="/setup" Execute="deferred" Return="ignore" Impersonate="no" />
        
        <Directory Id="TARGETDIR" Name="SourceDir">
            <Component Id="CMakeTools" Guid="a286eaec-129e-4e7b-b3dd-a2f0c46448d9">
            </Component>
            <Directory Id="ProgramFilesFolder">
                <Directory Id="INSTALLLOCATION" Name="CMake Tools for Visual Studio">
                </Directory>
            </Directory>
            <?define VSVersion = 2010 ?>
            <Directory Id="VS2010SHELL" Name="VS2010ROOT">
                <Directory Id="CMake2010" Name="CMake">
                    <Directory Id="CMakeSnippets2010" Name="Snippets">
                        <Directory Id="CMakeSnippetsLocale2010" Name="1033">
                            <Component Id="CMakeSnippetsIndex2010" Guid="78cfc6a9-87ad-4bbe-abf3-dc9efb10f8f4">
                                <?include CMakeSnippetsIndex.wxi ?>
                            </Component>
                            <Directory Id="CMakeSnippetsSubdir2010" Name="Snippets">
                                <Component Id="CMakeSnippets2010" Guid="596d6079-3f57-41d8-9065-5b6487610b27">
                                    <?include CMakeSnippets.wxi ?>
                                </Component>
                            </Directory>
                        </Directory>
                    </Directory>
                </Directory>
            </Directory>
            <Directory Id="VS2010DIR" Name="VS2010">
                <Directory Id="Extensions2010" Name="Extensions">
                    <Directory Id="CMakeExtensions2010" Name="CMake Tools for Visual Studio">
                        <Component Id="CMakeTools2010" Guid="fcf7da9d-a549-47f7-b77d-de710efdab75">
                            <?include CMakeTools.wxi ?>
                            <ProgId Id="CMakeTools.cmake.10.0" Description="CMake File" Icon="CMakeLogo2010">
                                <Extension Id="cmake" ContentType="text/plain">
                                    <Verb Id="open" Command="Open" TargetProperty="VS2010DEVENV" Argument='"%1"' />
                                </Extension>
                            </ProgId>
                        </Component>
                    </Directory>
                </Directory>
                <Directory Id="Templates2010" Name="Templates">
                    <Directory Id="NewItems2010" Name="NewItems">
                        <Component Id="CMakeTemplates2010" Guid="b75e11ae-033a-4011-88db-2e72b937bbba">
                            <?include CMakeTemplates.wxi ?>
                        </Component>
                    </Directory>
                </Directory>
            </Directory>
            <?undef VSVersion ?>
            <?define VSVersion = 2012 ?>
            <Directory Id="VS2012SHELL" Name="VS2012ROOT">
                <Directory Id="CMake2012" Name="CMake">
                    <Directory Id="CMakeSnippets2012" Name="Snippets">
                        <Directory Id="CMakeSnippetsLocale2012" Name="1033">
                            <Component Id="CMakeSnippetsIndex2012" Guid="f88c7690-b6e0-424f-995d-e85e710dfbB5">
                                <?include CMakeSnippetsIndex.wxi ?>
                            </Component>
                            <Directory Id="CMakeSnippetsSubdir2012" Name="Snippets">
                                <Component Id="CMakeSnippets2012" Guid="3fbf7d1d-e62f-4194-8af3-fd2b86f46f65">
                                    <?include CMakeSnippets.wxi ?>
                                </Component>
                            </Directory>
                        </Directory>
                    </Directory>
                </Directory>
            </Directory>
            <Directory Id="VS2012DIR" Name="VS2012">
                <Directory Id="Extensions2012" Name="Extensions">
                    <Directory Id="CMakeExtension2012" Name="CMake Tools for Visual Studio">
                        <Component Id="CMakeTools2012" Guid="a2321ddb-a524-49f6-92fa-d339ac822ca7">
                            <?include CMakeTools.wxi ?>
                            <ProgId Id="CMakeTools.cmake.11.0" Description="CMake File" Icon="CMakeLogo2012">
                                <Extension Id="cmake" ContentType="text/plain">
                                    <Verb Id="open" Command="Open" TargetProperty="VS2012DEVENV" Argument='"%1"' />
                                </Extension>
                            </ProgId>
                        </Component>
                        <Directory Id="Templates2012" Name="Templates">
                            <Directory Id="NewItems2012" Name="NewItems">
                                <Component Id="CMakeTemplates2012" Guid="e94d6685-484f-43e1-ae7f-cd14fe66ed22">
                                    <?include CMakeTemplates.wxi ?>
                                </Component>
                            </Directory>
                        </Directory>
                    </Directory>
                </Directory>
            </Directory>
            <?undef VSVersion ?>
        </Directory>

        <Feature Id="CMakeTools" Title="CMake Tools for Visual Studio" Description="Syntax highlighting and IntelliSense for CMake in Visual Studio." Level="1" AllowAdvertise="no">
            <Feature Id="CMakeTools2010" Title="Visual Studio 2010 Extension" Description="Extension for Visual Studio 2010." Level="1" AllowAdvertise="no">
                <ComponentRef Id="CMakeTools2010" />
                <ComponentRef Id="CMakeTemplates2010" />
                <ComponentRef Id="CMakeSnippets2010" />
                <ComponentRef Id="CMakeSnippetsIndex2010" />
            </Feature>
            <Feature Id="CMakeTools2012" Title="Visual Studio 2012 Extension" Description="Extension for Visual Studio 2012." Level="1" AllowAdvertise="no">
                <ComponentRef Id="CMakeTools2012" />
                <ComponentRef Id="CMakeTemplates2012" />
                <ComponentRef Id="CMakeSnippets2012" />
                <ComponentRef Id="CMakeSnippetsIndex2012" />
            </Feature>

            <ComponentRef Id="CMakeTools" />
            <ComponentGroupRef Id="Product.Generated" />
        </Feature>

        <InstallExecuteSequence>
            <Custom Action="VS2012Setup" Before="InstallFinalize">VS2012DEVENV</Custom>
        </InstallExecuteSequence>

        <UI>
            <ProgressText Action="VS2012Setup" Template="[1]">Updating Visual Studio 2012 registration</ProgressText>
        </UI>
        
        <UIRef Id="WixUI_Mondo" />
        <UIRef Id="WixUI_ErrorProgressText" />

        <WixVariable Id="WixUILicenseRtf" Value="dist\License.rtf" />
    </Product>
</Wix>
